{"version":3,"sources":["../src/index.js"],"names":["pageDown","page","isEnd","evaluate","window","scrollBy","innerHeight","scrollY","document","documentElement","scrollHeight","fullPageScreenshot","options","quality","pagesCount","extraPixels","viewport","scrollTo","pageHeight","Math","ceil","devicePixelRatio","height","width","innerWidth","images","index","delay","waitFor","image","screenshot","fullPage","push","Jimp","read","path","write","cropped","pop","then","crop","getBufferAsync","AUTO","mergedImage","direction","Promise","resolve","reject"],"mappings":"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","sourcesContent":["/* eslint-disable no-undef */\n/* eslint-disable no-await-in-loop */\nimport merge from 'merge-img';\nimport Jimp from 'jimp';\n\nconst pageDown = async ( page ) => {\n    const isEnd = await page.evaluate( () => {\n        window.scrollBy( 0, window.innerHeight );\n        return window.scrollY >= document.documentElement.scrollHeight - window.innerHeight;\n    } );\n\n    return isEnd;\n};\n\nconst fullPageScreenshot = async ( page, options = {}, quality = 100) => {\n    const { pagesCount, extraPixels, viewport } = await page.evaluate( () => {\n        window.scrollTo( 0, 0 );\n        const pageHeight = document.documentElement.scrollHeight;\n        return {\n            pagesCount: Math.ceil( pageHeight / window.innerHeight ),\n            extraPixels: pageHeight % window.innerHeight * window.devicePixelRatio,\n            viewport: { height: window.innerHeight * window.devicePixelRatio, width: window.innerWidth * window.devicePixelRatio },\n        };\n    } );\n\n    const images = [];\n    for ( let index = 0; index < pagesCount; index += 1 ) {\n        if ( options.delay ) {\n            await page.waitFor( options.delay );\n        }\n        const image = await page.screenshot( { fullPage: false , quality: quality } );\n        await pageDown( page );\n        images.push( image );\n    }\n\n    if ( pagesCount === 1 ) {\n        const image = await Jimp.read( images[0] );\n        if ( options.path ) image.write( options.path );\n        return image;\n    }\n    // crop last image extra pixels\n    const cropped = await Jimp.read( images.pop() )\n        .then( image => image.crop( 0, viewport.height - extraPixels, viewport.width, extraPixels ) )\n        .then( image => image.getBufferAsync( Jimp.AUTO ) );\n\n    images.push( cropped );\n    const mergedImage = await merge( images, { direction: true } );\n \n    if (options.path) {\n        await new Promise((resolve, reject) => {\n          mergedImage.write(options.path, () => {\n            resolve();\n          });\n        });\n    };\n    \n    return mergedImage;\n};\n\nexport default fullPageScreenshot;\n"],"file":"index.js"}